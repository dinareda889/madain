<?phpdefined('BASEPATH') OR exit('No direct script access allowed');class Company_stats_c extends CI_Controller {    function __construct()    {        parent::__construct();        check_not_login();        $this->load->model(['Company_stats_m']);    }    public function index()    {        $data['all_company_stats'] = $this->Company_stats_m->get()->result();        $data['title']='احصائيات الشركة';        $this->template->load('template','company_stats/company_stats_data',$data);    }    function  get_ajax_company_stats()    {        $list = $this->Company_stats_m->get_datatables_company_stats();        $data = array();        $no = @$_POST['start'];        foreach ($list as $item) {            $no++;            $row = array();            $row[] = $no . ".";            $row[] = $item->company_clients;            $row[] = $item->company_services;            $row[] = $item->company_projects;            $row[] = $item->company_projects_done;//            $row[] = $item->description;            $row[]='            <div class="btn-block  btn-group-sm">            <a href="'.base_url().'Company_stats_c/edit_company_stats/'.$item->id.'" title="تعديل"   class="btn btn-info btn-sm">                                            <i class="fa fa-pencil-alt" > </i></a>                                                                    </div>            ';            $data[] = $row;        }        $output = array(            "draw" => @$_POST['draw'],            "recordsTotal" => $this->Company_stats_m->count_all_company_stats(),            "recordsFiltered" => $this->Company_stats_m->count_filtered_company_stats(),            "data" => $data,        );        // output to json format        echo json_encode($output);    }    public function get_load_details()    {        $id = $this->input->post('id');        //$data['all_details'] = $this->Company_stats_m->get_load_details($id)[0];        $data['all_details'] = $this->Company_stats_m->get($id)->row();        $this->load->view('company_stats/load_details_page', $data);    }    /****************************************************************/    public function thumb($data,$folder_name)    {        $config['image_library'] = 'gd2';        $config['source_image'] = $data['full_path'];        $config['new_image'] = 'uploads/'.$folder_name.'/thumbs/' . $data['file_name'];        $config['create_thumb'] = TRUE;        $config['maintain_ratio'] = TRUE;        $config['thumb_marker'] = '';        $config['width'] = 275;        $config['height'] = 250;        $this->load->library('image_lib', $config);        $this->image_lib->initialize($config);        $this->image_lib->resize();    }    private  function upload_image($file_name,$folder_name){        $config['upload_path'] = 'uploads/'.$folder_name;        $config['allowed_types'] = 'gif|Gif|ico|ICO|jpg|JPG|jpeg|JPEG|BNG|png|PNG|bmp|BMP|WMV|wmv|MP3|mp3|FLV|flv|SWF|swf';        $config['max_size']    = '1024*8';        $config['encrypt_name']=true;        $this->load->library('upload',$config);        $this->upload->initialize($config);        if(! $this->upload->do_upload($file_name)){            return  false;        }else{            $datafile = $this->upload->data();            $this->thumb($datafile,$folder_name);//            echo '<br>'. $datafile['file_name'];            return  $datafile['file_name'];        }    }    public function add_company_stats() /* Company_stats_c/add_company_stats*/    {        $this->load->helper(array('form','url'));        $this->load->library(array('form_validation'));        $this->form_validation->set_rules('company_clients', 'عملاء الشركة', 'required');        $this->form_validation->set_rules('company_services', 'الخدمات', 'required');        $this->form_validation->set_rules('company_projects', ' المشاريع', 'required');        $this->form_validation->set_rules('company_projects_done', ' المشاريع التى تم تنفيذها', 'required');        if ($this->form_validation->run() == FALSE) {            $company_stats = new stdClass();            $company_stats->id = null;            $company_stats->company_clients = null;            $company_stats->company_services = null;            $company_stats->company_projects = null;            $company_stats->company_projects_done = null;            $data = array(                'page' => 'add',                'company_stats' => $company_stats,            );            $this->template->load('template', 'company_stats/company_stats_form', $data);        } else {            $post = $this->input->post(null, TRUE);            if (isset($_POST['add'])) {                $this->Company_stats_m->add_company_stats($post);                if ($this->db->affected_rows() > 0) {                    $this->session->set_flashdata('success', 'تمت العملية بنجاح ');                }                redirect('Company_stats_c', 'refresh');            }        }    }    public function edit_company_stats($id)    {        $this->load->helper(array('form', 'url'));        $this->load->library('form_validation');        $this->form_validation->set_rules('company_clients', 'عملاء الشركة', 'required');        $this->form_validation->set_rules('company_services', 'الخدمات', 'required');        $this->form_validation->set_rules('company_projects', ' المشاريع', 'required');        $this->form_validation->set_rules('company_projects_done', ' المشاريع التى تم تنفيذها', 'required');        if ($this->form_validation->run() == FALSE) {            $query = $this->Company_stats_m->get($id);            if ($query->num_rows() > 0) {                $company_stats = $query->row();                $data = array(                    'page' => 'edit',                    'company_stats' => $company_stats,                );                $this->template->load('template', 'company_stats/company_stats_edit', $data);            } else {                redirect('Company_stats_c', 'refresh');            }        } else {            $post = $this->input->post(null, TRUE);            if (isset($_POST['add'])) {                $this->Company_stats_m->edit_company_stats($post);            }            if ($this->db->affected_rows() > 0) {                $this->session->set_flashdata('success', 'تمت العملية بنجاح ');            }else{                $this->session->set_flashdata('danger', 'حدث خطأ يرجي المحاوله مره أخري ');            }            redirect('Company_stats_c', 'refresh');        }    }    public function delete_company_stats($id){        $this->Company_stats_m->delete_company_stats($id);        if($this->db->affected_rows() >0){            $this->session->set_flashdata('success', 'تم الحذف بنجاح');        }        redirect('Company_stats_c','refresh');    }}